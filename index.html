<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta property="og:type" content="website">
<meta property="og:title" content="Lam2003&#39;s Blog">
<meta property="og:url" content="https://linmin.xyz/index.html">
<meta property="og:site_name" content="Lam2003&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lam2003">
<meta name="twitter:card" content="summary"><title>Lam2003's Blog</title><link ref="canonical" href="https://linmin.xyz/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.3.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Lam2003's Blog</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2021/02/03/Istio%E6%90%AD%E5%BB%BA%E7%AC%94%E8%AE%B0/">Istio安装笔记</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2021-02-03</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2021-02-03</span></span></div></header><div class="post-body"><div class="post-excerpt"><ul>
<li>
        <h4 id="在k8s上安装Istio"   >
          <a href="#在k8s上安装Istio" class="heading-link"><i class="fas fa-link"></i></a><a href="#在k8s上安装Istio" class="headerlink" title="在k8s上安装Istio"></a>在k8s上安装Istio</h4>
        <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#下载istio</span><br><span class="line">export ISTIO_VERSION&#x3D;1.5.0</span><br><span class="line">curl -L https:&#x2F;&#x2F;istio.io&#x2F;downloadIstio | sh -</span><br><span class="line">mv .&#x2F;istio-1.5.0 &#x2F;opt&#x2F;istio </span><br><span class="line">#修改&#x2F;etc&#x2F;environment，将&#x2F;opt&#x2F;istio&#x2F;bin加入PATH</span><br><span class="line">sudo echo PATH&#x3D;$PATH:&#x2F;opt&#x2F;istio&#x2F;bin &gt; &#x2F;etc&#x2F;environment</span><br><span class="line">source &#x2F;etc&#x2F;environment</span><br><span class="line">#在k8s上安装istio，此处我们使用default模式安装</span><br><span class="line">#在进行这一步之前，需要确保用户目录中已配置kubeconfig（~&#x2F;.kube&#x2F;config）</span><br><span class="line">istioctl manifest apply --set profile&#x3D;default --set addonComponents.kiali.enabled&#x3D;true</span><br></pre></td></tr></table></div></figure>
<p>  可在安装时添加 <em>–set addonComponents.xxx.enabled=true</em>（xxx为组件名称）进行安装</p>
</li>
<li>
        <h4 id="kiali初始化配置"   >
          <a href="#kiali初始化配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#kiali初始化配置" class="headerlink" title="kiali初始化配置"></a>kiali初始化配置</h4>
      <p>  新版kiali由于未在docker环境变量中设置登录名与密码，导致初始登录时报错。解决办法：在kiali <em>Deployment.spec.template.spec.containters.env</em>中加入以下环境变量：</p>
  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;SERVER_CREDENTIALS_USERNAME&quot;,</span><br><span class="line">    &quot;valueFrom&quot;: &#123;</span><br><span class="line">        &quot;secretKeyRef&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &quot;kiali&quot;,</span><br><span class="line">            &quot;key&quot;: &quot;username&quot;,</span><br><span class="line">            &quot;optional&quot;: true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;SERVER_CREDENTIALS_PASSWORD&quot;,</span><br><span class="line">    &quot;valueFrom&quot;: &#123;</span><br><span class="line">    &quot;secretKeyRef&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;kiali&quot;,</span><br><span class="line">        &quot;key&quot;: &quot;passphrase&quot;,</span><br><span class="line">        &quot;optional&quot;: true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<p>  然后为kiali创建configmap：</p>
  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic kiali -n istio-system --from-literal&#x3D;username&#x3D;admin --from-literal&#x3D;passphrase&#x3D;admin</span><br></pre></td></tr></table></div></figure>
<p>  用户名：admin，密码：admin</p>
</li>
<li>
        <h4 id="解决istio中的外部鉴权问题"   >
          <a href="#解决istio中的外部鉴权问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#解决istio中的外部鉴权问题" class="headerlink" title="解决istio中的外部鉴权问题"></a>解决istio中的外部鉴权问题</h4>
      <p>  istio官方推荐使用jwt进行鉴权，这种鉴权方法需要用户先去鉴权服务请求一个token，然后将此token置于http request的header之中。由于我们使用的token是由yy UDB生成的，此种鉴权方法并不适合我们。在ServiceMesh v1版本我们开发了一个ext-authz服务进行鉴权，要想在istio中使用，只需要编写envoyfilter，在<em>envoy.route</em>之前加入<em>envoy.ext_authz</em>，把流量导入ext-authz服务。</p>
<p>  ingress-gateway-ef.yaml:</p>
  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: networking.istio.io&#x2F;v1alpha3</span><br><span class="line">kind: EnvoyFilter</span><br><span class="line">metadata:</span><br><span class="line">  name: ingress-gateway-ef</span><br><span class="line">  namespace: istio-system</span><br><span class="line">spec:</span><br><span class="line">  workloadSelector:</span><br><span class="line">    labels:</span><br><span class="line">      app: istio-ingressgateway</span><br><span class="line">  configPatches:</span><br><span class="line">  - applyTo: HTTP_FILTER </span><br><span class="line">    match:</span><br><span class="line">      context: ANY</span><br><span class="line">      listener:</span><br><span class="line">        portNumber: 80</span><br><span class="line">        filterChain:</span><br><span class="line">          filter:</span><br><span class="line">            name: envoy.http_connection_manager</span><br><span class="line">            subFilter:</span><br><span class="line">              name: envoy.router</span><br><span class="line">    patch:</span><br><span class="line">      operation: INSERT_BEFORE</span><br><span class="line">      value:</span><br><span class="line">        name: envoy.ext_authz</span><br><span class="line">        config: </span><br><span class="line">          grpc_service:</span><br><span class="line">            envoy_grpc: </span><br><span class="line">              cluster_name: outbound|8888||ext-authz.default.svc.cluster.local</span><br><span class="line"></span><br></pre></td></tr></table></div></figure></li>
<li><p>istio使用地域感知</p>
<ol>
<li><p>由于我们的k8s集群是单集群-跨机房部署，请求需要优先就近路由到本地机房服务去处理以降低请求延时。istio1.1版本以上提供了地域感知的功能（Locality Load Balancing），能够在无侵入的情况下实现就近路由的功能。配置方法如下：<br>在istio pilot <em>Deployment.spec.template.spec.containters.env</em>中加入环境变量：</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;PILOT_ENABLE_LOCALITY_LOAD_BALANCING&quot;,</span><br><span class="line">    &quot;value&quot;: &quot;1&quot;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
</li>
<li><p>在名为istio的configmap中找到<em>localityLbSetting</em>项，确保其处于<em>enabled: true</em>状态（默认处于开启状态），如果流量控制需要更加细化，可以参考 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://istio.io/docs/reference/config/networking/destination-rule/#LocalityLoadBalancerSetting" >LocalityLoadBalancerSetting</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>进行配置</p>
</li>
<li><p>在k8s node上打上region/zone标签，标签全称请参考：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubernetes-api/labels-annotations-taints/" >k8s知名标签</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">kubectl label node worker-sz02 topology.kubernetes.io&#x2F;region&#x3D;shenzhen</span><br><span class="line">kubectl label node worker-sz03 topology.kubernetes.io&#x2F;region&#x3D;shenzhen</span><br><span class="line">kubectl label node worker-bj02 topology.kubernetes.io&#x2F;region&#x3D;beijing</span><br><span class="line">kubectl label node worker-wx02 topology.kubernetes.io&#x2F;region&#x3D;wuxi</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
</li>
<li><p>由于 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/istio/istio/issues/12947#issuecomment-478836687" >#12947</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，我们需要在DestinationRule中为Service配置熔断规则，地域感知才会生效。DestinationRule示例如下：</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: networking.istio.io&#x2F;v1alpha3</span><br><span class="line">kind: DestinationRule</span><br><span class="line">metadata:</span><br><span class="line">  name: outlier</span><br><span class="line">spec:</span><br><span class="line">  host: &quot;google.com&quot;</span><br><span class="line">  trafficPolicy:</span><br><span class="line">    outlierDetection:</span><br><span class="line">      consecutiveErrors: 7</span><br><span class="line">      interval: 5m</span><br><span class="line">      baseEjectionTime: 15m</span><br></pre></td></tr></table></div></figure>

<p>配置完成后进行测试，在DestinationRule中配置LoadBalance规则，无论是轮询还是一致性hash，请求都是在本地机房处理的（例如从深圳ingress-gateway进来的请求，只会在深圳机房内进行处理），满足我们的设计需要</p>
</li>
</ol>
</li>
<li><p>istio+k8s服务暴露方式</p>
  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">深圳机房                                                                         </span><br><span class="line">                                                                         </span><br><span class="line">    </span><br><span class="line">    Physical Server1                                                             </span><br><span class="line">    +-----------------------------------------------------+     </span><br><span class="line">    |                             PodA                    |                                        </span><br><span class="line">    |                             +---------------------+ |</span><br><span class="line">    | Docker端口直接映射到主机端口    |  DeamonSet+HostPort | | </span><br><span class="line">    |&lt;---------------------------&gt;|+k8sService          |-|---------------+                   </span><br><span class="line">    |                             |istio-ingress-gateway| |               |</span><br><span class="line">    |                             +---------------------+ |               |              </span><br><span class="line">    |                                      |              |               |</span><br><span class="line">    |                                      |flannel       |               |</span><br><span class="line">    |                          PodB        V              |               |</span><br><span class="line">    |                   +--------------------------+      |               |</span><br><span class="line">    |                   |  DeploymentSet+k8sService|      |               |flannel</span><br><span class="line">    |                   |    BIZ-Service1          |      |               |</span><br><span class="line">    |                   |                          |      |               |</span><br><span class="line">    |                   +--------------------------+      |               |  </span><br><span class="line">    |                                                     |               |</span><br><span class="line">    |                                                     |               |</span><br><span class="line">    |                                                     |               |</span><br><span class="line">    |                                                     |               |</span><br><span class="line">    +-----------------------------------------------------+               |</span><br><span class="line">                                                                          |</span><br><span class="line">                                                                          |</span><br><span class="line">                                                                          |</span><br><span class="line">    Physical Server2                                                      |</span><br><span class="line">    +------------------------------------------------------+              |</span><br><span class="line">    |                             PodC                     |              |                      </span><br><span class="line">    |                   +------------------------+         |              |</span><br><span class="line">    |                   |DeploymentSet+k8sService|         |              |</span><br><span class="line">    |                   |    BIZ_Service2        |&lt;--------|--------------+ </span><br><span class="line">    |                   |                        |         |</span><br><span class="line">    |                   +------------------------+         |</span><br><span class="line">    |                                      |               |</span><br><span class="line">    |                                      |flannel        | </span><br><span class="line">    |                          PodD        V               |</span><br><span class="line">    |                   +--------------------------+       |</span><br><span class="line">    |                   |  DeploymentSet+k8sService|       |</span><br><span class="line">    |                   |    BIZ_Service3          |       |</span><br><span class="line">    |                   |                          |       |</span><br><span class="line">    |                   +-------------------------+|       |                </span><br><span class="line">    |                                                      |               </span><br><span class="line">    |                                                      |</span><br><span class="line">    |                                                      |</span><br><span class="line">    |                                                      |</span><br><span class="line">    +------------------------------------------------------+ </span><br><span class="line">              </span><br><span class="line">              </span><br></pre></td></tr></table></div></figure>
<p>  istio-ingresss-gateway使用DaemonSet进行部署，在DaemonSet中添加NodeSelector，对打上了front_end=true标签的节点进行部署，由于我们使用HostPort的方式进行服务暴露，部署时需要确定物理机上的80/443等端口未被占用。为了使用istio地域感知功能，需要为ingress-gateway配置k8s Service，否则地域感知不生效。内部的业务服务使用Deployment+k8sService的方式进行部署，可配置水平伸缩容器。</p>
<p>  <strong>A&amp;Q</strong></p>
<ol>
<li><p>istio-ingress-gateway为什么不使用k8s NodePort进行服务暴露？如下图所示，使用NodePort的情况下，从节点1进入的请求可能被转发到节点2进行处理，不适用于跨机房k8s集群</p>
<p><img src="https://linmin.xyz/wp-content/uploads/2020/03/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_1584961059743.png" alt="image"></p>
</li>
<li><p>为何不使用k8s官方推荐的LoadBalance作为istio-ingress-gateway的暴露方式？</p>
<p>使用LB需要网络设备的支持（LoadBalancer在数据链路层发送ARP），需要服务器处于同一交换机内。对于跨机房k8s集群不适用。<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://juejin.im/entry/5aeb158f518825672033e90f" >LB原理</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</li>
</ol>
</li>
<li><p>使用sds进行https单向证书配置<br>  在istio-ingressgateway Gateway.spec.servers添加tls</p>
  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">kind: Gateway</span><br><span class="line">apiVersion: networking.istio.io&#x2F;v1alpha3</span><br><span class="line">metadata:</span><br><span class="line">  name: ingressgateway</span><br><span class="line">  namespace: istio-system</span><br><span class="line">  selfLink: &gt;-</span><br><span class="line">    &#x2F;apis&#x2F;networking.istio.io&#x2F;v1alpha3&#x2F;namespaces&#x2F;istio-system&#x2F;gateways&#x2F;ingressgateway</span><br><span class="line">  uid: ad31ce80-6caf-11ea-b592-6c92bf4940c4</span><br><span class="line">  resourceVersion: &#39;490919&#39;</span><br><span class="line">  generation: 3</span><br><span class="line">  creationTimestamp: &#39;2020-03-23T02:40:36Z&#39;</span><br><span class="line">  labels:</span><br><span class="line">    operator.istio.io&#x2F;component: IngressGateways</span><br><span class="line">    operator.istio.io&#x2F;managed: Reconcile</span><br><span class="line">    operator.istio.io&#x2F;version: 1.5.0</span><br><span class="line">    release: istio</span><br><span class="line">  annotations:</span><br><span class="line">    kubectl.kubernetes.io&#x2F;last-applied-configuration: &gt;</span><br><span class="line">      &#123;&quot;apiVersion&quot;:&quot;networking.istio.io&#x2F;v1alpha3&quot;,&quot;kind&quot;:&quot;Gateway&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;labels&quot;:&#123;&quot;operator.istio.io&#x2F;component&quot;:&quot;IngressGateways&quot;,&quot;operator.istio.io&#x2F;managed&quot;:&quot;Reconcile&quot;,&quot;operator.istio.io&#x2F;version&quot;:&quot;1.5.0&quot;,&quot;release&quot;:&quot;istio&quot;&#125;,&quot;name&quot;:&quot;ingressgateway&quot;,&quot;namespace&quot;:&quot;istio-system&quot;&#125;,&quot;spec&quot;:&#123;&quot;selector&quot;:&#123;&quot;istio&quot;:&quot;ingressgateway&quot;&#125;,&quot;servers&quot;:[&#123;&quot;hosts&quot;:[&quot;*&quot;],&quot;port&quot;:&#123;&quot;name&quot;:&quot;http&quot;,&quot;number&quot;:80,&quot;protocol&quot;:&quot;HTTP&quot;&#125;&#125;]&#125;&#125;</span><br><span class="line">spec:</span><br><span class="line">  servers:</span><br><span class="line">    - hosts:</span><br><span class="line">        - &#39;*&#39;</span><br><span class="line">      port:</span><br><span class="line">        name: http</span><br><span class="line">        number: 80</span><br><span class="line">        protocol: HTTP</span><br><span class="line">    - hosts:</span><br><span class="line">        - front.100.com</span><br><span class="line">      port:</span><br><span class="line">        name: https</span><br><span class="line">        number: 443</span><br><span class="line">        protocol: HTTPS</span><br><span class="line">      tls:</span><br><span class="line">        credentialName: yy-cr</span><br><span class="line">        mode: SIMPLE</span><br><span class="line">        privateKey: sds</span><br><span class="line">        serverCertificate: sds</span><br><span class="line">  selector:</span><br><span class="line">    istio: ingressgateway</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<p>  在终端输入</p>
  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#注意文件名称必须为cert与key，否则sds不识别</span><br><span class="line">kubectl create secret generic  cr-yy --from-file&#x3D;cert  --from-file&#x3D;key -n istio-system </span><br></pre></td></tr></table></div></figure>
</li>
</ul>
</div></div></article></section><nav class="paginator"><div class="paginator-inner"><span class="page-number current">1</span></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">A Trash Coderr</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/lam2003" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">1</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">1</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">2</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2021</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>lam2003</span><span class="footer__devider">|</span><span><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">粤ICP备20016116号</a></span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__info">访问人数</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">浏览总量</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>